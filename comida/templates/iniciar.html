{% extends 'base.html' %}
{% load static %}
{% block title %} inicio sesión {% endblock %}

{% block content %}


<link rel="stylesheet" href="{% static 'login.css' %}">

<div class="loginn">
    <div class="login-cont">
        <h2>Iniciar Sesión</h2>
        <form action="/iniciar" method="post">
            {% csrf_token %}
            <label for="username">Nombre de Usuario:</label>
            <input type="text" placeholder="Ingrese su usuario" id="username" name="username" required>
            <label for="password">Contraseña:</label>
            <div class="password-container">
                <input type="password" placeholder="Ingrese su contraseña" id="password" name="password" required>
                <i id="togglePassword" class="fa fa-eye" onclick="togglePassword()"></i>
            </div>
            <input type="submit" value="Iniciar Sesión">
            {% if error %}
                <p class="error">{{ error }}</p>
            {% endif %}
        </form>

        
        <a href="{% url 'restablecer' %}" >¿Olvidaste tu contraseña?</a>

       

        <p>¿No tienes cuenta? <a href="{% url 'regis' %}">Regístrate aquí</a></p>
    </div>
</div>
{% if error %}
    <script type="text/javascript">
        alert("{{ error }}");
    </script>
{% endif %}

<script type="text/javascript">
    function abrirRecuperacion() {
        Swal.fire({
            title: 'Recuperar Contraseña',
            html: `
                <p>Ingresa tu correo y te enviaremos un enlace para restablecer tu contraseña.</p>
                <input type="email" id="emailRecuperacion" class="swal2-input" placeholder="correo@example.com">
            `,
            confirmButtonText: 'Enviar',
            showCancelButton: true,
            cancelButtonText: 'Cancelar',
            preConfirm: () => {
                const email = document.getElementById('emailRecuperacion').value;
                if (!email) {
                    Swal.showValidationMessage('Debes ingresar un correo válido');
                    return false;
                }
                return fetch('/recuperar-contrasena-ajax/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCSRFToken()
                    },
                    body: JSON.stringify({ email: email })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        Swal.fire('¡Correo enviado!', data.message, 'success');
                    } else {
                        Swal.fire('Error', data.message, 'error');
                    }
                })
                .catch(() => {
                    Swal.fire('Error', 'Ocurrió un problema, intenta de nuevo.', 'error');
                });
            }
        });
    }
  
    // Función para obtener el CSRF token desde las cookies
    function getCSRFToken() {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.startsWith('csrftoken=')) {
                    cookieValue = cookie.substring('csrftoken='.length);
                    break;
                }
            }
        }
        return cookieValue;
    }
  </script>
  
<script type="text/javascript">
    window.onload = function() {
            var passwordField = document.getElementById('password');
            var toggleIcon = document.getElementById('togglePassword');
            
            // Asegurarse de que el campo de la contraseña esté oculto por defecto
            passwordField.type = 'password';  // La contraseña está oculta por defecto
            toggleIcon.classList.add('fa-eye-slash');  // Añadir el ícono con la raya
        }
    function togglePassword() {
        var passwordField = document.getElementById('password');
        var passwordType = passwordField.type;
        var toggleIcon = document.getElementById('togglePassword');

        // Cambiar entre 'password' y 'text'
        if (passwordType === 'password') {
            passwordField.type = 'text';  // Mostrar la contraseña
            toggleIcon.classList.remove('fa-eye-slash');
            toggleIcon.classList.add('fa-eye');  // Cambiar ícono
        } else {
            passwordField.type = 'password';  // Ocultar la contraseña
            toggleIcon.classList.remove('fa-eye');
            toggleIcon.classList.add('fa-eye-slash');  // Cambiar ícono
        }
    }
</script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">



{% endblock %}